<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
		<title>Penguin Glider - Arctic Adventure</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			html,
			body {
				margin: 0;
				padding: 0;
				background: #000;
				font-family: "Arial", sans-serif;
				overflow: hidden;
				touch-action: none; /* Prevent default touch behaviors */
				user-select: none; /* Prevent text selection */
				position: relative;
				width: 100%;
				height: 100%;
				/* Prevent zoom on mobile */
				-webkit-text-size-adjust: 100%;
				-ms-text-size-adjust: 100%;
			}

			body {
				position: fixed;
				top: 0;
				left: 0;
				width: 100vw;
				height: 100vh;
			}

			canvas {
				display: block;
				position: absolute;
				top: 0;
				left: 0;
				width: 100vw;
				height: 100vh;
				background: linear-gradient(to bottom, #87ceeb 0%, #4682b4 50%, #1e3a8a 100%);
				z-index: 1;
				/* Prevent canvas from being selectable */
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}

			/* UI Elements overlay */
			.ui-overlay {
				position: fixed;
				top: 0;
				left: 0;
				width: 100vw;
				height: 100vh;
				pointer-events: none;
				z-index: 10;
				display: flex;
				flex-direction: column;
			}

			.top-ui {
				display: flex;
				justify-content: space-between;
				align-items: flex-start;
				padding: max(20px, env(safe-area-inset-top, 20px)) 20px 20px 20px;
				width: 100%;
				gap: 20px;
			}

			.score {
				font-size: clamp(24px, 5vw, 32px);
				font-weight: bold;
				color: #ffd700;
				text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
				background: rgba(0, 0, 0, 0.3);
				padding: clamp(8px, 2vw, 10px) clamp(15px, 4vw, 20px);
				border-radius: 15px;
				backdrop-filter: blur(10px);
				white-space: nowrap;
			}

			.instructions {
				font-size: clamp(14px, 3vw, 18px);
				color: #e6f3ff;
				text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
				background: rgba(0, 0, 0, 0.3);
				padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 15px);
				border-radius: 10px;
				backdrop-filter: blur(10px);
				max-width: min(300px, 40vw);
				line-height: 1.4;
			}

			.game-over {
				position: fixed;
				top: 0;
				left: 0;
				width: 100vw;
				height: 100vh;
				text-align: center;
				display: none;
				z-index: 999;
				pointer-events: auto;
				color: #ffffff;
				
				/* Dark overlay background */
				background: rgba(0, 0, 0, 0.75);
				backdrop-filter: blur(5px);
				
				/* Center content */
				flex-direction: column;
				justify-content: center;
				align-items: center;
			}

			.game-over img {
				width: clamp(300px, 40vw, 500px);
				height: auto;
				cursor: pointer;
				transition: transform 0.2s;
				filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.5));
			}

			.game-over img:hover {
				transform: scale(1.1);
			}

			.game-over p {
				font-family: "Digital-7", "LCD", monospace;
				color: #ffffff;
				font-size: clamp(16px, 4vw, 24px); /* smaller & adaptable */
				font-weight: 200;
				text-align: center;
				letter-spacing: 2px;
				margin-top: 30px;
			}

			/* Start Screen */
			.start-screen {
				position: fixed;
				top: 0;
				left: 0;
				width: 100vw;
				height: 100vh;
				background: linear-gradient(to bottom, #87ceeb 0%, #4682b4 50%, #1e3a8a 100%);
				color: white;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				z-index: 30;
				text-align: center;
				padding: 20px;
			}

			.start-screen h1 {
				font-size: clamp(32px, 8vw, 48px);
				margin-bottom: 30px;
				text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
			}

			.game-instructions {
				font-size: clamp(16px, 4vw, 20px);
				line-height: 1.6;
				margin-bottom: 40px;
				max-width: 600px;
				background: rgba(0, 0, 0, 0.3);
				padding: 20px;
				border-radius: 15px;
				backdrop-filter: blur(10px);
			}

			.play-button {
				background: #4a90e2;
				color: white;
				border: none;
				padding: clamp(15px, 4vw, 20px) clamp(30px, 8vw, 40px);
				border-radius: 15px;
				cursor: pointer;
				font-size: clamp(18px, 5vw, 24px);
				font-weight: bold;
				transition: all 0.3s;
				pointer-events: auto;
				touch-action: manipulation;
				box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
			}

			.play-button:hover,
			.play-button:active {
				background: #357abd;
				transform: scale(1.05);
				box-shadow: 0 8px 25px rgba(74, 144, 226, 0.6);
			}

			/* Mobile Controls */
			.mobile-controls {
				position: fixed;
				bottom: 0;
				left: 0;
				width: 100vw;
				height: clamp(160px, 40vh, 220px);
				display: none;
				flex-direction: row;
				justify-content: space-between;
				align-items: flex-end;
				padding: max(20px, env(safe-area-inset-bottom, 20px)) 20px;
				padding-bottom: 50px;
				z-index: 15;
				pointer-events: none;
				/* Add subtle overlay background */
				background: linear-gradient(
					to top,
					rgba(0, 0, 0, 0.3) 0%,
					rgba(0, 0, 0, 0.15) 40%,
					rgba(0, 0, 0, 0.05) 70%,
					transparent 100%
				);
			}

			/* Create gradient blur effect using pseudo-element */
			.mobile-controls::before {
				content: '';
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				backdrop-filter: blur(12px);
				-webkit-backdrop-filter: blur(12px);
				mask: linear-gradient(
					to top,
					rgba(0, 0, 0, 1) 0%,
					rgba(0, 0, 0, 0.8) 30%,
					rgba(0, 0, 0, 0.3) 70%,
					transparent 100%
				);
				-webkit-mask: linear-gradient(
					to top,
					rgba(0, 0, 0, 1) 0%,
					rgba(0, 0, 0, 0.8) 30%,
					rgba(0, 0, 0, 0.3) 70%,
					transparent 100%
				);
				pointer-events: none;
				z-index: -1;
			}

			.control-button {
				background: transparent;
				border: none;
				padding: 0;
				width: clamp(60px, 20vw, 100px);
				height: clamp(60px, 20vw, 100px);
				display: flex;
				align-items: center;
				justify-content: center;
				touch-action: manipulation;
				user-select: none;
				transition: all 0.1s;
				pointer-events: auto;
				flex-shrink: 0;
				filter: drop-shadow(0 6px 20px rgba(0, 0, 0, 0.4));
			}

			.control-button img {
				width: 100%;
				height: 100%;
				object-fit: contain;
				pointer-events: none;
			}

			.control-button:active {
				transform: scale(0.95);
				filter: drop-shadow(0 3px 10px rgba(0, 0, 0, 0.5));
			}

			.jump-button {
				flex: 0 0 auto;
				margin: 0;
				flex-grow: 1;
				/* width: 100%; */
			}

			.jump-button:active {
				transform: scale(0.95);
			}

			/* Show mobile controls on touch devices */
			@media (hover: none) and (pointer: coarse) {
				.mobile-controls {
					display: flex !important;
				}

				.instructions {
					font-size: clamp(12px, 3vw, 16px);
				}

				/* Hide instructions on very small screens when controls are visible */
				@media (max-height: 600px) {
					.instructions {
						display: none;
					}
				}
			}

			/* Alternative mobile detection */
			@media (max-width: 768px) {
				.mobile-controls {
					display: flex;
				}

				.top-ui {
					flex-direction: column;
					align-items: center;
					gap: 10px;
				}

				.instructions {
					text-align: center;
					max-width: 80vw;
				}
			}

			/* Very small screens */
			@media (max-width: 480px) {
				.top-ui {
					padding: 10px;
				}

				.score {
					font-size: clamp(20px, 5vw, 24px);
				}

				.instructions {
					font-size: clamp(12px, 3vw, 14px);
				}

				.mobile-controls {
					bottom: 0;
					padding: max(10px, env(safe-area-inset-bottom, 10px)) 10px;
					padding-bottom: max(40px, env(safe-area-inset-bottom, 40px));
					gap: 0;
				}

				.control-button {
					min-width: clamp(50px, 12vw, 60px);
					min-height: clamp(50px, 12vw, 60px);
					font-size: clamp(16px, 3.5vw, 18px);
					padding: 0;
				}

				.jump-button {
					min-height: clamp(60px, 15vw, 70px);
					font-size: clamp(16px, 3.5vw, 20px);
					margin: 0;
				}
			}

			/* Landscape orientation on mobile */
			@media (max-height: 500px) and (orientation: landscape) {
				.top-ui {
					padding: 5px 20px;
					flex-direction: row;
					justify-content: space-between;
				}

				.instructions {
					font-size: clamp(10px, 2vw, 14px);
					max-width: 50vw;
				}

				.mobile-controls {
					bottom: 0;
					padding: max(5px, env(safe-area-inset-bottom, 5px)) 15px;
					padding-bottom: max(30px, env(safe-area-inset-bottom, 30px));
				}

				.control-button {
					min-width: clamp(40px, 8vw, 50px);
					min-height: clamp(40px, 8vw, 50px);
					font-size: clamp(14px, 2.5vw, 16px);
				}

				.jump-button {
					min-height: clamp(45px, 10vw, 55px);
					font-size: clamp(14px, 2.5vw, 18px);
				}
			}

			/* Loading Circle Styles */
			.loading-circle {
				position: fixed;
				width: clamp(30px, 8vw, 40px);
				height: clamp(30px, 8vw, 40px);
				left: 50%;
				top: calc(50% + clamp(140px, 35vw, 180px));
				transform: translateX(-50%);
				z-index: 1002;
				border: 3px solid rgba(74, 144, 226, 0.3);
				border-left: 3px solid #4a90e2;
				border-radius: 50%;
				animation: spin 1s linear infinite;
				filter: drop-shadow(0 0 12px rgba(74, 144, 226, 0.6));
			}

			@keyframes spin {
				0% { transform: translateX(-50%) rotate(0deg); }
				100% { transform: translateX(-50%) rotate(360deg); }
			}

			/* Loading text */
			.loading-text {
				position: fixed;
				left: 50%;
				top: calc(50% + clamp(200px, 45vw, 240px));
				transform: translateX(-50%);
				z-index: 1002;
				font-family: "Segoe UI", Arial, Helvetica Neue, sans-serif;
				font-weight: 300;
				font-size: clamp(14px, 4vw, 16px);
				color: #4a90e2;
				text-align: center;
				text-shadow: 0 2px 8px rgba(74, 144, 226, 0.4);
				opacity: 0.8;
				white-space: nowrap;
			}

			/* Mobile specific positioning for timer and score below progress bar */
			@media (hover: none) and (pointer: coarse) {
				#gameTimer {
					top: calc(max(20px, env(safe-area-inset-top, 20px)) + 60px) !important;
					left: 15px !important;
					font-size: clamp(24px, 4.5vw, 32px) !important;
				}

				/* Target the dynamically created score container */
				#gameScore {
					top: calc(max(20px, env(safe-area-inset-top, 20px)) + 60px) !important;
					right: 15px !important;
				}

				/* Make score elements smaller */
				#gameScore div {
					font-size: clamp(24px, 4.5vw, 32px) !important;
				}

				#gameScore div:last-child {
					font-size: clamp(12px, 2.5vw, 16px) !important;
				}

				.top-ui {
					position: fixed !important;
					top: calc(max(20px, env(safe-area-inset-top, 20px)) + 60px) !important;
					right: 15px !important;
					left: auto !important;
					width: auto !important;
					padding: 0 !important;
					margin: 0 !important;
				}

				.score {
					margin: 0 !important;
					font-size: clamp(18px, 4vw, 24px) !important;
					padding: clamp(6px, 1.5vw, 8px) clamp(10px, 2.5vw, 12px) !important;
				}

				.instructions {
					display: none !important;
				}
			}

			@media (max-width: 768px) {
				#gameTimer {
					top: calc(max(20px, env(safe-area-inset-top, 20px)) + 60px) !important;
					left: 15px !important;
					font-size: clamp(24px, 4.5vw, 32px) !important;
				}

				/* Target the dynamically created score container */
				#gameScore {
					top: calc(max(20px, env(safe-area-inset-top, 20px)) + 60px) !important;
					right: 15px !important;
				}

				/* Make score elements smaller */
				#gameScore div {
					font-size: clamp(24px, 4.5vw, 32px) !important;
				}

				#gameScore div:last-child {
					font-size: clamp(12px, 2.5vw, 16px) !important;
				}

				.top-ui {
					position: fixed !important;
					top: calc(max(20px, env(safe-area-inset-top, 20px)) + 60px) !important;
					right: 15px !important;
					left: auto !important;
					width: auto !important;
					padding: 0 !important;
					margin: 0 !important;
				}

				.score {
					margin: 0 !important;
					font-size: clamp(18px, 4vw, 24px) !important;
					padding: clamp(6px, 1.5vw, 8px) clamp(10px, 2.5vw, 12px) !important;
				}

				.instructions {
					display: none !important;
				}
			}

			/* Very small screens adjustments */
			@media (max-width: 480px) {
				#gameTimer {
					top: calc(max(20px, env(safe-area-inset-top, 20px)) + 50px) !important;
					left: 10px !important;
					font-size: clamp(20px, 4vw, 28px) !important;
				}

				/* Target the dynamically created score container */
				#gameScore {
					top: calc(max(20px, env(safe-area-inset-top, 20px)) + 50px) !important;
					right: 10px !important;
				}

				/* Make score elements smaller */
				#gameScore div {
					font-size: clamp(20px, 4vw, 28px) !important;
				}

				#gameScore div:last-child {
					font-size: clamp(10px, 2vw, 14px) !important;
				}

				.top-ui {
					position: fixed !important;
					top: calc(max(20px, env(safe-area-inset-top, 20px)) + 50px) !important;
					right: 10px !important;
					left: auto !important;
					width: auto !important;
					padding: 0 !important;
					margin: 0 !important;
				}

				.score {
					margin: 0 !important;
					font-size: clamp(16px, 3.5vw, 20px) !important;
					padding: clamp(4px, 1vw, 6px) clamp(8px, 2vw, 10px) !important;
				}

				.instructions {
					display: none !important;
				}
			}

			/* Landscape orientation on mobile */
			@media (max-height: 500px) and (orientation: landscape) {
				#gameTimer {
					top: calc(max(20px, env(safe-area-inset-top, 20px)) + 45px) !important;
					left: 10px !important;
					font-size: clamp(18px, 3.5vw, 24px) !important;
				}

				/* Target the dynamically created score container */
				#gameScore {
					top: calc(max(20px, env(safe-area-inset-top, 20px)) + 45px) !important;
					right: 10px !important;
				}

				/* Make score elements smaller */
				#gameScore div {
					font-size: clamp(18px, 3.5vw, 24px) !important;
				}

				#gameScore div:last-child {
					font-size: clamp(9px, 1.8vw, 12px) !important;
				}

				.top-ui {
					position: fixed !important;
					top: calc(max(20px, env(safe-area-inset-top, 20px)) + 45px) !important;
					right: 10px !important;
					left: auto !important;
					width: auto !important;
					padding: 0 !important;
					margin: 0 !important;
				}

				.score {
					margin: 0 !important;
					font-size: clamp(14px, 3vw, 18px) !important;
					padding: clamp(3px, 0.8vw, 5px) clamp(6px, 1.5vw, 8px) !important;
				}

				.instructions {
					display: none !important;
				}
			}

			/* Mobile-specific progress bar sizing */
			@media (hover: none) and (pointer: coarse), (max-width: 768px) {
				.progress-bar-container {
					width: 320px !important;
					max-width: 75vw !important;
					gap: 10px !important;
				}

				.progress-bar-track {
					height: 20px !important;
					border-radius: 10px !important;
					border: 2px solid #000000 !important;
				}

				.progress-penguin {
					width: 24px !important;
					height: 24px !important;
					top: -14px !important;
				}

				.progress-baby-penguin {
					width: 32px !important;
					height: 32px !important;
				}

				.score-message {
					font-size: clamp(14px, 3.5vw, 18px) !important;
				}
			}

			@media (max-width: 480px) {
				.progress-bar-container {
					width: 280px !important;
					max-width: 70vw !important;
					gap: 8px !important;
				}

				.progress-bar-track {
					height: 18px !important;
					border-radius: 9px !important;
					border: 2px solid #000000 !important;
				}

				.progress-penguin {
					width: 20px !important;
					height: 20px !important;
					top: -12px !important;
				}

				.progress-baby-penguin {
					width: 28px !important;
					height: 28px !important;
				}

				.score-message {
					font-size: clamp(12px, 3vw, 16px) !important;
				}
			}

			@media (max-height: 500px) and (orientation: landscape) {
				.progress-bar-container {
					width: 250px !important;
					max-width: 60vw !important;
					gap: 6px !important;
				}

				.progress-bar-track {
					height: 16px !important;
					border-radius: 8px !important;
					border: 2px solid #000000 !important;
				}

				.progress-penguin {
					width: 18px !important;
					height: 18px !important;
					top: -10px !important;
				}

				.progress-baby-penguin {
					width: 24px !important;
					height: 24px !important;
				}

				.score-message {
					font-size: clamp(11px, 2.5vw, 14px) !important;
				}
			}

			/* Mobile-specific fish icon sizing */
			@media (hover: none) and (pointer: coarse), (max-width: 768px) {
				.fish-icon {
					height: clamp(18px, 3vw, 24px) !important;
					margin-right: 6px !important;
				}
			}

			@media (max-width: 480px) {
				.fish-icon {
					height: clamp(16px, 2.5vw, 20px) !important;
					margin-right: 4px !important;
				}
			}

			@media (max-height: 500px) and (orientation: landscape) {
				.fish-icon {
					height: clamp(14px, 2vw, 18px) !important;
					margin-right: 4px !important;
				}
			}
		</style>
	</head>
	<body>
		<!-- Start Screen -->
		<div class="start-screen" id="startScreen"></div>

		<canvas id="gameCanvas"></canvas>

		<!-- UI Overlay -->

		<!-- Mobile Touch Controls -->
		<div class="mobile-controls" id="mobileControls">
			<button class="control-button" id="leftBtn">
				<img src="img/left.png" alt="Left" style="width: 100%; height: 100%; object-fit: contain" />
			</button>
			<button class="control-button jump-button" id="jumpBtn">
				<img src="img/jump.png" alt="Jump/Glide" style="width: 100%; height: 100%; object-fit: contain" />
			</button>
			<button class="control-button" id="rightBtn">
				<img src="img/right.png" alt="Right" style="width: 100%; height: 100%; object-fit: contain" />
			</button>
		</div>

		<!-- Game Over Display -->
		<div class="game-over" id="gameOver">
			<p>OOOOPS you fell in the icy water!</p>
			<br /><br />
			<img src="img/try-again.png" onclick="restartGame()" alt="Try Again" />
		</div>

		<!-- Win Screen Modal -->
		<div class="game-over" id="winScreen">
			<h2>🎉 Level Complete! 🎉</h2>
			<p>You successfully reached the end with enough fish! 🐟</p>
			<p>Final Score: <span id="winScore">0</span> fish</p>
			<p>Time Remaining: <span id="winTime">0:00</span></p>
			<button class="restart-btn" onclick="restartGame()">Play Again</button>
		</div>

		<script src="game.js"></script>
		<script>
			// Start screen functionality
			function startGame() {
				const startScreen = document.getElementById("startScreen");
				startScreen.style.display = "none";

				// Initialize and start the game with default autoStart behavior
				if (typeof game === "undefined") {
					game = new PenguinGlider(); // Default autoStart = true
				} else {
					game.restart();
				}
			}

			// Restart game directly without showing start screen
			let isRestarting = false; // Prevent rapid clicking
			function restartGame() {
				// Prevent rapid clicking
				if (isRestarting) {
					console.log("Restart already in progress, ignoring click");
					return;
				}

				isRestarting = true;
				console.log("Starting restart process");

				const gameOver = document.getElementById("gameOver");
				const winScreen = document.getElementById("winScreen");
				gameOver.style.display = "none";
				winScreen.style.display = "none";

				if (game) {
					game.restart();
				} else {
					// Clean up any existing UI elements before creating new game
					cleanupGameUI();
					game = new PenguinGlider();
				}

				// Reset the restart flag after a delay to allow the restart to complete
				setTimeout(() => {
					isRestarting = false;
					console.log("Restart process complete");
				}, 500);
			}

			// Helper function to clean up existing game UI elements
			function cleanupGameUI() {
				// Remove any existing score containers
				const existingScoreContainers = document.querySelectorAll('div[style*="fixed"][style*="right: 20px"]');
				existingScoreContainers.forEach((container) => {
					if (container.parentNode) {
						container.parentNode.removeChild(container);
					}
				});

				// Remove any existing progress containers
				const existingProgressContainers = document.querySelectorAll('div[style*="fixed"][style*="left: 50%"]');
				existingProgressContainers.forEach((container) => {
					if (container.parentNode) {
						container.parentNode.removeChild(container);
					}
				});

				// Remove any existing game timer elements
				const existingTimers = document.querySelectorAll("#gameTimer");
				existingTimers.forEach((timer) => {
					if (timer.parentNode) {
						timer.parentNode.removeChild(timer);
					}
				});
			}

			// Function to return to start screen (if needed)
			function returnToStart() {
				const startScreen = document.getElementById("startScreen");
				startScreen.style.display = "flex";

				const gameOver = document.getElementById("gameOver");
				gameOver.style.display = "none";
			}
		</script>
		<script src="timer.js"></script>
		<script src="start.js"></script>
	</body>
</html>
	</body>
</html>